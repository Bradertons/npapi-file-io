<!DOCTYPE XHTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>NPAPI File IO test</title>
  <script type="text/javascript" src="../app/jsUnitCore.js"></script>
  <script type="text/javascript">
  var plugin = document.createElement("embed");
  plugin.setAttribute("type", "application/x-npapi-file-io");
  document.documentElement.appendChild(plugin);
  
  function getPlatform() {
    return "windows";
  }
  
  function getPath(filename) {
    if (getPlatform() === "windows") {
      return "C:\\svn\\npapi-file-io\\test\\files\\" + filename;
    }
    throw "Unsupported platform";
  }
  
  function testDetectsPlatformAsWindows() {
    assertEquals("windows", getPlatform());
  }
  
  function testGetPathReturnsFileInPath() {
    var filename = "file";
    assertEquals("C:\\svn\\npapi-file-io\\test\\files\\" + filename, getPath(filename));
  }

  function testFileExistsReturnsFalseForNonExistentFile() {
    var nonexistent = getPath("nonexistent.txt");
    assertFalse(plugin.fileExists(nonexistent));
  }
  
  function testFileExistsReturnsTrueForExistentFile() {
    var exists = getPath("exists.txt");
    assertTrue(plugin.fileExists(exists));
  }
  
  function testGetTextFileForTextFileReturnsFileContents() {
    var exists = getPath("exists.txt");
    assertEquals("I contain\nsome text\n  on multiple lines", plugin.getTextFile(exists));
  }
  
  function testGetBinaryFileForTextFileReturnsFileContents() {
    var a = getPath("a.txt");
    assertEquals([97], plugin.getBinaryFile(a));
  }
  
  function testGetBinaryFileForBinaryFileContainingNullReturnsFileContents() {
    var a = getPath("containsnull.txt");
    assertEquals([97, 0, 99], plugin.getBinaryFile(a));
  }
  
  function testGetTextFileForBinaryFileContainingNullReturnsUndefined() {
    var a = getPath("containsnull.txt");
    assertEquals(undefined, plugin.getTextFile(a));
  }
  
  //TODO: ls
  //TODO: test invalid parameters
  </script>
</head>
<body>
</body>
</html>